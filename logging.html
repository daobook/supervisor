
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Logging &#8212; Supervisor 4.3.0.dev0 文档</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/repoze.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/translations.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="Events" href="events.html" />
    <link rel="prev" title="Subprocesses" href="subprocess.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="logging">
<h1>Logging<a class="headerlink" href="#logging" title="永久链接至标题">¶</a></h1>
<p>One of the main tasks that <strong class="program">supervisord</strong> performs is logging.
<strong class="program">supervisord</strong> logs an activity log detailing what it’s doing
as it runs.  It also logs child process stdout and stderr output to
other files if configured to do so.</p>
<section id="activity-log">
<h2>Activity Log<a class="headerlink" href="#activity-log" title="永久链接至标题">¶</a></h2>
<p>The activity log is the place where <strong class="program">supervisord</strong> logs
messages about its own health, its subprocess’ state changes, any
messages that result from events, and debug and informational
messages.  The path to the activity log is configured via the
<code class="docutils literal notranslate"><span class="pre">logfile</span></code> parameter in the <code class="docutils literal notranslate"><span class="pre">[supervisord]</span></code> section of the
configuration file, defaulting to <code class="file docutils literal notranslate"><span class="pre">$CWD/supervisord.log</span></code>.  If
the value of this option is the special string <code class="docutils literal notranslate"><span class="pre">syslog</span></code>, the
activity log will be routed to the syslog service instead of being
written to a file.  Sample activity log traffic is shown in the
example below.  Some lines have been broken to better fit the screen.</p>
<section id="sample-activity-log-output">
<h3>Sample Activity Log Output<a class="headerlink" href="#sample-activity-log-output" title="永久链接至标题">¶</a></h3>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>2007-09-08 14:43:22,886 DEBG 127.0.0.1:Medusa (V1.11) started at Sat Sep  8 14:43:22 2007
        Hostname: kingfish
        Port:9001
2007-09-08 14:43:22,961 INFO RPC interface &#39;supervisor&#39; initialized
2007-09-08 14:43:22,961 CRIT Running without any HTTP authentication checking
2007-09-08 14:43:22,962 INFO supervisord started with pid 27347
2007-09-08 14:43:23,965 INFO spawned: &#39;listener_00&#39; with pid 27349
2007-09-08 14:43:23,970 INFO spawned: &#39;eventgen&#39; with pid 27350
2007-09-08 14:43:23,990 INFO spawned: &#39;grower&#39; with pid 27351
2007-09-08 14:43:24,059 DEBG &#39;listener_00&#39; stderr output:
 /Users/chrism/projects/supervisor/supervisor2/dev-sandbox/bin/python:
 can&#39;t open file &#39;/Users/chrism/projects/supervisor/supervisor2/src/supervisor/scripts/osx_eventgen_listener.py&#39;:
 [Errno 2] No such file or directory
2007-09-08 14:43:24,060 DEBG fd 7 closed, stopped monitoring &lt;PEventListenerDispatcher at 19910168 for
 &lt;Subprocess at 18892960 with name listener_00 in state STARTING&gt; (stdout)&gt;
2007-09-08 14:43:24,060 INFO exited: listener_00 (exit status 2; not expected)
2007-09-08 14:43:24,061 DEBG received SIGCHLD indicating a child quit
</pre></div>
</div>
<p>The activity log “level” is configured in the config file via the
<code class="docutils literal notranslate"><span class="pre">loglevel</span></code> parameter in the <code class="docutils literal notranslate"><span class="pre">[supervisord]</span></code> ini file section.
When <code class="docutils literal notranslate"><span class="pre">loglevel</span></code> is set, messages of the specified priority, plus
those with any higher priority are logged to the activity log.  For
example, if <code class="docutils literal notranslate"><span class="pre">loglevel</span></code> is <code class="docutils literal notranslate"><span class="pre">error</span></code>, messages of <code class="docutils literal notranslate"><span class="pre">error</span></code> and
<code class="docutils literal notranslate"><span class="pre">critical</span></code> priority will be logged.  However, if loglevel is
<code class="docutils literal notranslate"><span class="pre">warn</span></code>, messages of <code class="docutils literal notranslate"><span class="pre">warn</span></code>, <code class="docutils literal notranslate"><span class="pre">error</span></code>, and <code class="docutils literal notranslate"><span class="pre">critical</span></code> will be
logged.</p>
</section>
<section id="activity-log-levels">
<span id="id1"></span><h3>Activity Log Levels<a class="headerlink" href="#activity-log-levels" title="永久链接至标题">¶</a></h3>
<p>The below table describes the logging levels in more detail, ordered
in highest priority to lowest.  The “Config File Value” is the string
provided to the <code class="docutils literal notranslate"><span class="pre">loglevel</span></code> parameter in the <code class="docutils literal notranslate"><span class="pre">[supervisord]</span></code>
section of configuration file and the “Output Code” is the code that
shows up in activity log output lines.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 15%" />
<col style="width: 61%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Config File Value</p></th>
<th class="head"><p>Output Code</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>critical</p></td>
<td><p>CRIT</p></td>
<td><p>Messages that indicate a condition that
requires immediate user attention, a
supervisor state change, or an error in
supervisor itself.</p></td>
</tr>
<tr class="row-odd"><td><p>error</p></td>
<td><p>ERRO</p></td>
<td><p>Messages that indicate a potentially
ignorable error condition (e.g. unable to
clear a log directory).</p></td>
</tr>
<tr class="row-even"><td><p>warn</p></td>
<td><p>WARN</p></td>
<td><p>Messages that indicate an anomalous
condition which isn’t an error.</p></td>
</tr>
<tr class="row-odd"><td><p>info</p></td>
<td><p>INFO</p></td>
<td><p>Normal informational output.  This is the
default log level if none is explicitly
configured.</p></td>
</tr>
<tr class="row-even"><td><p>debug</p></td>
<td><p>DEBG</p></td>
<td><p>Messages useful for users trying to debug
process configuration and communications
behavior (process output, listener state
changes, event notifications).</p></td>
</tr>
<tr class="row-odd"><td><p>trace</p></td>
<td><p>TRAC</p></td>
<td><p>Messages useful for developers trying to
debug supervisor plugins, and information
about HTTP and RPC requests and responses.</p></td>
</tr>
<tr class="row-even"><td><p>blather</p></td>
<td><p>BLAT</p></td>
<td><p>Messages useful for developers trying to
debug supervisor itself.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="activity-log-rotation">
<h3>Activity Log Rotation<a class="headerlink" href="#activity-log-rotation" title="永久链接至标题">¶</a></h3>
<p>The activity log is “rotated” by <strong class="program">supervisord</strong> based on the
combination of the <code class="docutils literal notranslate"><span class="pre">logfile_maxbytes</span></code> and the <code class="docutils literal notranslate"><span class="pre">logfile_backups</span></code>
parameters in the <code class="docutils literal notranslate"><span class="pre">[supervisord]</span></code> section of the configuration file.
When the activity log reaches <code class="docutils literal notranslate"><span class="pre">logfile_maxbytes</span></code> bytes, the current
log file is moved to a backup file and a new activity log file is
created.  When this happens, if the number of existing backup files is
greater than or equal to <code class="docutils literal notranslate"><span class="pre">logfile_backups</span></code>, the oldest backup file
is removed and the backup files are renamed accordingly.  If the file
being written to is named <code class="file docutils literal notranslate"><span class="pre">supervisord.log</span></code>, when it exceeds
<code class="docutils literal notranslate"><span class="pre">logfile_maxbytes</span></code>, it is closed and renamed to
<code class="file docutils literal notranslate"><span class="pre">supervisord.log.1</span></code>, and if files <code class="file docutils literal notranslate"><span class="pre">supervisord.log.1</span></code>,
<code class="file docutils literal notranslate"><span class="pre">supervisord.log.2</span></code> etc. exist, then they are renamed to
<code class="file docutils literal notranslate"><span class="pre">supervisord.log.2</span></code>, <code class="file docutils literal notranslate"><span class="pre">supervisord.log.3</span></code> etc.
respectively.  If <code class="docutils literal notranslate"><span class="pre">logfile_maxbytes</span></code> is 0, the logfile is never
rotated (and thus backups are never made).  If <code class="docutils literal notranslate"><span class="pre">logfile_backups</span></code> is
0, no backups will be kept.</p>
</section>
</section>
<section id="child-process-logs">
<h2>Child Process Logs<a class="headerlink" href="#child-process-logs" title="永久链接至标题">¶</a></h2>
<p>The stdout of child processes spawned by supervisor, by default, is
captured for redisplay to users of <strong class="program">supervisorctl</strong> and other
clients.  If no specific logfile-related configuration is performed in
a <code class="docutils literal notranslate"><span class="pre">[program:x]</span></code>, <code class="docutils literal notranslate"><span class="pre">[fcgi-program:x]</span></code>, or <code class="docutils literal notranslate"><span class="pre">[eventlistener:x]</span></code>
section in the configuration file, the following is true:</p>
<ul class="simple">
<li><p><strong class="program">supervisord</strong> will capture the child process’ stdout and
stderr output into temporary files.  Each stream is captured to a
separate file.  This is known as <code class="docutils literal notranslate"><span class="pre">AUTO</span></code> log mode.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AUTO</span></code> log files are named automatically and placed in the
directory configured as <code class="docutils literal notranslate"><span class="pre">childlogdir</span></code> of the <code class="docutils literal notranslate"><span class="pre">[supervisord]</span></code>
section of the config file.</p></li>
<li><p>The size of each <code class="docutils literal notranslate"><span class="pre">AUTO</span></code> log file is bounded by the
<code class="docutils literal notranslate"><span class="pre">{streamname}_logfile_maxbytes</span></code> value of the program section
(where {streamname} is “stdout” or “stderr”).  When it reaches that
number, it is rotated (like the activity log), based on the
<code class="docutils literal notranslate"><span class="pre">{streamname}_logfile_backups</span></code>.</p></li>
</ul>
<p>The configuration keys that influence child process logging in
<code class="docutils literal notranslate"><span class="pre">[program:x]</span></code> and <code class="docutils literal notranslate"><span class="pre">[fcgi-program:x]</span></code> sections are these:</p>
<p><code class="docutils literal notranslate"><span class="pre">redirect_stderr</span></code>, <code class="docutils literal notranslate"><span class="pre">stdout_logfile</span></code>, <code class="docutils literal notranslate"><span class="pre">stdout_logfile_maxbytes</span></code>,
<code class="docutils literal notranslate"><span class="pre">stdout_logfile_backups</span></code>, <code class="docutils literal notranslate"><span class="pre">stdout_capture_maxbytes</span></code>, <code class="docutils literal notranslate"><span class="pre">stdout_syslog</span></code>,
<code class="docutils literal notranslate"><span class="pre">stderr_logfile</span></code>, <code class="docutils literal notranslate"><span class="pre">stderr_logfile_maxbytes</span></code>,
<code class="docutils literal notranslate"><span class="pre">stderr_logfile_backups</span></code>, <code class="docutils literal notranslate"><span class="pre">stderr_capture_maxbytes</span></code>, and
<code class="docutils literal notranslate"><span class="pre">stderr_syslog</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">[eventlistener:x]</span></code> sections may not specify
<code class="docutils literal notranslate"><span class="pre">redirect_stderr</span></code>, <code class="docutils literal notranslate"><span class="pre">stdout_capture_maxbytes</span></code>, or
<code class="docutils literal notranslate"><span class="pre">stderr_capture_maxbytes</span></code>, but otherwise they accept the same values.</p>
<p>The configuration keys that influence child process logging in the
<code class="docutils literal notranslate"><span class="pre">[supervisord]</span></code> config file section are these:
<code class="docutils literal notranslate"><span class="pre">childlogdir</span></code>, and <code class="docutils literal notranslate"><span class="pre">nocleanup</span></code>.</p>
<section id="capture-mode">
<span id="id2"></span><h3>Capture Mode<a class="headerlink" href="#capture-mode" title="永久链接至标题">¶</a></h3>
<p>Capture mode is an advanced feature of Supervisor.  You needn’t
understand capture mode unless you want to take actions based on data
parsed from subprocess output.</p>
<p>If a <code class="docutils literal notranslate"><span class="pre">[program:x]</span></code> section in the configuration file defines a
non-zero <code class="docutils literal notranslate"><span class="pre">stdout_capture_maxbytes</span></code> or <code class="docutils literal notranslate"><span class="pre">stderr_capture_maxbytes</span></code>
parameter, each process represented by the program section may emit
special tokens on its stdout or stderr stream (respectively) which
will effectively cause supervisor to emit a <code class="docutils literal notranslate"><span class="pre">PROCESS_COMMUNICATION</span></code>
event (see <a class="reference internal" href="events.html#events"><span class="std std-ref">Events</span></a> for a description of events).</p>
<p>The process communications protocol relies on two tags, one which
commands supervisor to enter “capture mode” for the stream and one
which commands it to exit.  When a process stream enters “capture
mode”, data sent to the stream will be sent to a separate buffer in
memory, the “capture buffer”, which is allowed to contain a maximum of
<code class="docutils literal notranslate"><span class="pre">capture_maxbytes</span></code> bytes.  During capture mode, when the buffer’s
length exceeds <code class="docutils literal notranslate"><span class="pre">capture_maxbytes</span></code> bytes, the earliest data in the
buffer is discarded to make room for new data.  When a process stream
exits capture mode, a <code class="docutils literal notranslate"><span class="pre">PROCESS_COMMUNICATION</span></code> event subtype is
emitted by supervisor, which may be intercepted by event listeners.</p>
<p>The tag to begin “capture mode” in a process stream is
<code class="docutils literal notranslate"><span class="pre">&lt;!--XSUPERVISOR:BEGIN--&gt;</span></code>.  The tag to exit capture mode is
<code class="docutils literal notranslate"><span class="pre">&lt;!--XSUPERVISOR:END--&gt;</span></code>.  The data between these tags may be
arbitrary, and forms the payload of the <code class="docutils literal notranslate"><span class="pre">PROCESS_COMMUNICATION</span></code>
event.  For example, if a program is set up with a
<code class="docutils literal notranslate"><span class="pre">stdout_capture_maxbytes</span></code> of “1MB”, and it emits the following on
its stdout stream:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&lt;!--XSUPERVISOR:BEGIN--&gt;Hello!&lt;!--XSUPERVISOR:END--&gt;
</pre></div>
</div>
<p>In this circumstance, <strong class="program">supervisord</strong> will emit a
<code class="docutils literal notranslate"><span class="pre">PROCESS_COMMUNICATIONS_STDOUT</span></code> event with data in the payload of
“Hello!”.</p>
<p>An example of a script (written in Python) which emits a process
communication event is in the <code class="file docutils literal notranslate"><span class="pre">scripts</span></code> directory of the
supervisor package, named <code class="file docutils literal notranslate"><span class="pre">sample_commevent.py</span></code>.</p>
<p>The output of processes specified as “event listeners”
(<code class="docutils literal notranslate"><span class="pre">[eventlistener:x]</span></code> sections) is not processed this way.
Output from these processes cannot enter capture mode.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo_hi.gif" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="index.html">Supervisor</a></h1>








<h3>导航</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing.html">安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">运行 Supervisor</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">配置文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="subprocess.html">Subprocesses</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Logging</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#activity-log">Activity Log</a></li>
<li class="toctree-l2"><a class="reference internal" href="#child-process-logs">Child Process Logs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="events.html">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="xmlrpc.html">Extending Supervisor’s XML-RPC API</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrading.html">Upgrading Supervisor 2 to 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Resources and Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">XML-RPC API Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="plugins.html">Third Party Applications and Libraries</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="subprocess.html" title="上一章">Subprocesses</a></li>
      <li>Next: <a href="events.html" title="下一章">Events</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2004-2022, Agendaless Consulting and Contributors.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/logging.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>